<% if @current_user.predecessor.heir_type == "Teacher" %>
<% @current_user.diploma_works.each do |diploma_work| %>
  <h2>Diploma work: <%= diploma_work.title %></h2>
  <table>  
    <thead>
      <tr>
  			<th>Name</th>
  			<th>Number</th>
        <th>Grade</th>	
        <th>Grades</th>
        <th>First</th>
        <th>Second</th>
  	    <th>Third</th>
        <th>Options</th>
      </tr>
    </thead>


    <tbody>
      <% @diplomants = @students.where("students.first = '#{diploma_work.id}'") %>
      <% @diplomants = @diplomants.sort_by {|s| s.grades}.reverse %>
      <% @diplomants.each do |student| %>
        <tr>
          <td><%= student.name %></td>
          <td><%= student.number %></td>
          
          <td><%= student.grade %></td>
        
          <td><%= student.grades %></td>
          <td><% if d = DiplomaWork.find_by_id(student.first) %>
                <%= d.title  %>
              <% end %>
          </td>
          <td><% if d = DiplomaWork.find_by_id(student.second) %>
                <%= d.title  %>
              <% end %>
          </td>
          <td><% if d = DiplomaWork.find_by_id(student.third) %>
                <%= d.title  %>
              <% end %>
          </td>
          <td><%= button_to "Get student", {action: "get_student", id: student.id, diploma_work_id: diploma_work.id} %></td>
        </tr>
      <% end %>
      <%= link_to "Don't want them", assemble_path %>

      <% @diplomants = @students.where("students.diploma_work_id =  '#{diploma_work.id}'") %>
      <% @diplomants.each do |student| %>
        <tr>
          <td><%= student.name %></td>
          <td><%= student.number %></td>
          
          <td><%= student.grade %></td>
        
          <td><%= student.grades %></td>
          <td><% if d = DiplomaWork.find_by_id(student.first) %>
                <%= d.title  %>
              <% end %>
          </td>
          <td><% if d = DiplomaWork.find_by_id(student.second) %>
                <%= d.title  %>
              <% end %>
          </td>
          <td><% if d = DiplomaWork.find_by_id(student.third) %>
                <%= d.title  %>
              <% end %>
          </td>
          <td><% if student.first == diploma_work.id %>
                <%= button_to "Remove", {action: "remove_student", id: student.id, diploma_work_id: diploma_work.id} %>
              <% else %>
                Have it
              <% end %>

          </td>
        </tr>
      <% end %>

    </tbody>
  </table>
  <br />
<% end %>
<% end %>

<script>
var table = $('table');

$('#facility_header, #city_header')
    .wrapInner('<span title="sort this column"/>')
    .each(function(){

        var th = $(this),
            thIndex = th.index(),
            inverse = false;

        th.click(function(){

            table.find('td').filter(function(){

                return $(this).index() === thIndex;

            }).sortElements(function(a, b){

                if( $.text([a]) == $.text([b]) )
                    return 0;

                return $.text([a]) > $.text([b]) ?
                    inverse ? -1 : 1
                    : inverse ? 1 : -1;

            }, function(){

                // parentNode is the element we want to move
                return this.parentNode; 

            });

            inverse = !inverse;

        });

    });
	</script>
<br>